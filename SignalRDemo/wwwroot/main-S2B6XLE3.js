import{$ as W,A as Lt,B as Mt,G as ue,H as Et,J as Dt,K as Tt,M as Ot,N as Rt,O as Pt,P as jt,Q as Gt,R as Nt,S as E,T as he,U as V,V as Vt,W as fe,X as P,Y as D,Z as g,_ as Wt,a as at,aa as Z,b as st,c as ct,d as lt,e as pt,f as mt,g as dt,h as pe,i as ut,j as ht,k as ft,l as gt,m as vt,n as me,o as St,p as yt,q as _t,r as xt,s as Ct,t as bt,u as de,v as It,w as wt,x as kt,y as At,z as Ft}from"./chunk-MBXM6TYG.js";import{$b as ce,Bb as w,Eb as y,F as Ge,Fa as Ye,Fc as it,Gb as d,Gc as R,Hc as nt,Ic as ot,J as Ne,Jc as rt,Lc as le,Pb as B,Q as Ve,Qb as l,R as We,Rb as b,Sb as H,T as $e,U as ae,Ua as c,V as Be,Va as v,Wa as Ze,X as k,Ya as Ke,Yb as F,Zb as z,_ as He,_a as Xe,_b as U,a as Te,aa as _,b as Oe,ba as ke,bb as Qe,d as we,db as Y,fa as A,g as $,h as Re,hc as et,i as Pe,ia as ze,j as ne,ja as Ue,jb as f,m as je,na as qe,oa as x,ob as m,pa as C,q as S,qc as O,rb as X,t as oe,wa as se,xa as Je,xb as s,xc as tt,y as K,yb as r,z as re,zb as h}from"./chunk-62WP7Q22.js";import{a as L,b as ie,f as J}from"./chunk-RNMDN42R.js";var ge=class{email;password;constructor(n,e){this.email=n,this.password=e}},ve=class{email;password;name;constructor(n,e,i){this.email=n,this.password=e,this.name=i}};var $t=(()=>{class t{appService;signalrService;methodName="Authentification";successCommand="Auth_Success";failCommand="Auth_Fail";constructor(e,i){this.appService=e,this.signalrService=i}launchAuthentification(e){this.authentificationListenSuccess(),this.authentificationListenFail(),this.authentificationAsync(e)}authentificationAsync(e){return J(this,null,function*(){console.log("#3 authentificationAsync: First authorization"),yield this.signalrService.hubConnection.invoke(this.methodName,e).then(()=>{console.log("#6 authentificationAsync: After Listener")}).catch(i=>console.log(i))})}authentificationListenSuccess(){try{console.log("#2 authentificationListenSuccess"),this.signalrService.hubConnection.on(this.successCommand,e=>{console.log("#4 authentificationListenSuccess"),this.appService.userData=L({},e),localStorage.setItem("token",e.token),this.appService.isAuthenticated.set(!0),this.appService.showSnackbar("Login succsessfully!"),this.appService.isAdminUser()?this.appService.router.navigate(["user-connection-state"]):this.appService.router.navigate(["account"]),this.signalrService.offConnection([this.successCommand,this.failCommand])})}catch(e){console.log(e)}}authentificationListenFail(){console.log("#2 authentificationListenFail"),this.signalrService.hubConnection.on(this.failCommand,()=>{console.log("#4 wrong credentials"),this.appService.showSnackbar("Wrong credentials!")})}static \u0275fac=function(i){return new(i||t)(_(g),_(W))};static \u0275prov=k({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Bt=(()=>{class t{appService;signalrService;methodName="Registration";successCommand="Register_Success";failCommand="Register_Fail";constructor(e,i){this.appService=e,this.signalrService=i}launchRegistration(e){this.registrationListenSuccess(),this.registrationListenFail(),this.registrationAsync(e)}registrationAsync(e){return J(this,null,function*(){console.log("#3 registration: invoke"),yield this.signalrService.hubConnection.invoke(this.methodName,e).then(()=>{console.log("#6 registration After Listener")}).catch(i=>console.log(i))})}registrationListenSuccess(){console.log("#2 registrationListenSuccess"),this.signalrService.hubConnection.on(this.successCommand,e=>{console.log("#4 registrationListenSuccess"),this.appService.userData=L({},e),localStorage.setItem("token",e.token),this.appService.isAuthenticated.set(!0),this.appService.showSnackbar("Registrated successfully!"),this.appService.router.navigate(["account"]),this.signalrService.offConnection([this.successCommand,this.failCommand])})}registrationListenFail(){console.log("#2 registrationListenFail"),this.signalrService.hubConnection.on(this.failCommand,()=>{console.log("#4 registrationListenFail"),this.appService.showSnackbar("Such email already taken. Please choose another one.")})}static \u0275fac=function(i){return new(i||t)(_(g),_(W))};static \u0275prov=k({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function mi(t,n){t&1&&(s(0,"mat-error"),l(1,"Email is required."),r())}function di(t,n){t&1&&(s(0,"mat-error"),l(1,"Invalid email format."),r())}function ui(t,n){t&1&&(s(0,"mat-error"),l(1,"Password is required."),r())}function hi(t,n){t&1&&(s(0,"mat-error"),l(1,"Name is required."),r())}function fi(t,n){if(t&1&&(s(0,"mat-form-field",4)(1,"mat-label"),l(2,"Name"),r(),h(3,"input",11),f(4,hi,2,0,"mat-error",6),r()),t&2){let e=d();c(4),m("ngIf",e.authForm.controls.name.hasError("required"))}}function gi(t,n){if(t&1&&(s(0,"div",12),l(1),r()),t&2){let e=d();c(),b(e.errorMessage)}}var zt=(()=>{class t{fb;appService;authService;registerService;errorMessage="";isRegisterMode=O(()=>this.appService.isRegisterMode());authForm;constructor(e,i,o,a){this.fb=e,this.appService=i,this.authService=o,this.registerService=a}ngOnInit(){this.initialForm()}initialForm(){this.authForm=this.fb.group({email:["",[me.required,me.email]],password:["",me.required],name:[""]})}onSubmit(){this.authForm.invalid||(this.isRegisterMode()?this.registerService.launchRegistration(new ve(this.authForm.value.email,this.authForm.value.password,this.authForm.value.name)):this.authService.launchAuthentification(new ge(this.authForm.value.email,this.authForm.value.password)))}static \u0275fac=function(i){return new(i||t)(v(bt),v(g),v($t),v(Bt))};static \u0275cmp=A({type:t,selectors:[["app-auth"]],standalone:!0,features:[F],decls:21,vars:9,consts:[["fxLayout","column","fxLayoutAlign","center center",2,"width","300px","margin","auto"],[3,"ngSubmit","formGroup"],["fxLayout","column"],["fxLayout","column","fxLayoutAlign","center center"],["appearance","fill"],["matInput","","formControlName","email","placeholder","Email"],[4,"ngIf"],["matInput","","formControlName","password","type","password","placeholder","Password"],["appearance","fill",4,"ngIf"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["style","color: red;",4,"ngIf"],["matInput","","formControlName","name","placeholder","Name"],[2,"color","red"]],template:function(i,o){i&1&&(s(0,"div",0)(1,"h2"),l(2),r(),s(3,"form",1),y("ngSubmit",function(){return o.onSubmit()}),s(4,"div",2)(5,"div",3)(6,"mat-form-field",4)(7,"mat-label"),l(8,"Email"),r(),h(9,"input",5),f(10,mi,2,0,"mat-error",6)(11,di,2,0,"mat-error",6),r(),s(12,"mat-form-field",4)(13,"mat-label"),l(14,"Password"),r(),h(15,"input",7),f(16,ui,2,0,"mat-error",6),r(),f(17,fi,5,1,"mat-form-field",8),r(),s(18,"button",9),l(19),r()(),f(20,gi,2,1,"div",10),r()()),i&2&&(c(2),b(o.isRegisterMode()?"SignUp":"Login"),c(),m("formGroup",o.authForm),c(7),m("ngIf",o.authForm.controls.email.hasError("required")),c(),m("ngIf",o.authForm.controls.email.hasError("email")),c(5),m("ngIf",o.authForm.controls.password.hasError("required")),c(),m("ngIf",o.isRegisterMode()),c(),m("disabled",o.authForm.invalid),c(),H(" ",o.isRegisterMode()?"SignUp":"Login"," "),c(),m("ngIf",o.errorMessage))},dependencies:[D,R,_t,vt,St,yt,xt,Ct,de,Lt,At,Ft,Mt,E,P]})}return t})();var ye=(()=>{class t{appService;constructor(e){this.appService=e}canActivate(){return this.appService.isAuthenticated()?!0:(this.appService.router.navigate(["auth"]),!1)}static \u0275fac=function(i){return new(i||t)(_(g))};static \u0275prov=k({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var ee=class t{static commonStyles={width:"80px",height:"80px",color:"white",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"90%"};static noStyles={width:"70px",height:"70px",color:"white",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"90%",backgroundColor:"black"};static Rock={value:0,icon:"fa-regular fa-hand-back-fist fa-4x",sign:"Rock",styles:ie(L({},t.commonStyles),{backgroundColor:"#f44336"})};static Paper={value:1,icon:"fa-regular fa-hand fa-4x",sign:"Paper",styles:ie(L({},t.commonStyles),{backgroundColor:"#2196F3"})};static Scissors={value:2,icon:"fa-regular fa-hand-scissors fa-4x",sign:"Scissors",styles:ie(L({},t.commonStyles),{backgroundColor:"#6fb20c"})};static getByValue(n){return Object.values(t).find(e=>e.value===n)}static getAll(){return[this.Rock,this.Paper,this.Scissors]}};var vi={url:"",deserializer:t=>JSON.parse(t.data),serializer:t=>JSON.stringify(t)},Si="WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }",_e=class t extends Re{constructor(n,e){if(super(),this._socket=null,n instanceof we)this.destination=e,this.source=n;else{let i=this._config=Object.assign({},vi);if(this._output=new $,typeof n=="string")i.url=n;else for(let o in n)n.hasOwnProperty(o)&&(i[o]=n[o]);if(!i.WebSocketCtor&&WebSocket)i.WebSocketCtor=WebSocket;else if(!i.WebSocketCtor)throw new Error("no WebSocket constructor can be found");this.destination=new ne}}lift(n){let e=new t(this._config,this.destination);return e.operator=n,e.source=this,e}_resetState(){this._socket=null,this.source||(this.destination=new ne),this._output=new $}multiplex(n,e,i){let o=this;return new we(a=>{try{o.next(n())}catch(u){a.error(u)}let p=o.subscribe({next:u=>{try{i(u)&&a.next(u)}catch(I){a.error(I)}},error:u=>a.error(u),complete:()=>a.complete()});return()=>{try{o.next(e())}catch(u){a.error(u)}p.unsubscribe()}})}_connectSocket(){let{WebSocketCtor:n,protocol:e,url:i,binaryType:o}=this._config,a=this._output,p=null;try{p=e?new n(i,e):new n(i),this._socket=p,o&&(this._socket.binaryType=o)}catch(I){a.error(I);return}let u=new Te(()=>{this._socket=null,p&&p.readyState===1&&p.close()});p.onopen=I=>{let{_socket:N}=this;if(!N){p.close(),this._resetState();return}let{openObserver:De}=this._config;De&&De.next(I);let Ie=this.destination;this.destination=Oe.create(j=>{if(p.readyState===1)try{let{serializer:q}=this._config;p.send(q(j))}catch(q){this.destination.error(q)}},j=>{let{closingObserver:q}=this._config;q&&q.next(void 0),j&&j.code?p.close(j.code,j.reason):a.error(new TypeError(Si)),this._resetState()},()=>{let{closingObserver:j}=this._config;j&&j.next(void 0),p.close(),this._resetState()}),Ie&&Ie instanceof ne&&u.add(Ie.subscribe(this.destination))},p.onerror=I=>{this._resetState(),a.error(I)},p.onclose=I=>{p===this._socket&&this._resetState();let{closeObserver:N}=this._config;N&&N.next(I),I.wasClean?a.complete():a.error(I)},p.onmessage=I=>{try{let{deserializer:N}=this._config;a.next(N(I))}catch(N){a.error(N)}}}_subscribe(n){let{source:e}=this;return e?e.subscribe(n):(this._socket||this._connectSocket(),this._output.subscribe(n),n.add(()=>{let{_socket:i}=this;this._output.observers.length===0&&(i&&(i.readyState===1||i.readyState===0)&&i.close(),this._resetState())}),n)}unsubscribe(){let{_socket:n}=this;n&&(n.readyState===1||n.readyState===0)&&n.close(),this._resetState(),super.unsubscribe()}};function Fe(t){return new _e(t)}var te="",yi=(...t)=>t.reduce((n,e)=>(i,o)=>e(i,n(i,o))),Le=class{constructor(n){n&&n.length>0&&(this.reviver=yi(...n))}serialize(n){return n.map(e=>JSON.stringify(e)).join(te)+te}deserialize({data:n}){let e=n,i=e.length-te.length;if(e[i]!==te)throw new Error("Message is incomplete.");return e.substring(0,i).split(te).map(a=>JSON.parse(a,this.reviver))}};var G=function(t){return t[t.invocation=1]="invocation",t[t.streamItem=2]="streamItem",t[t.completion=3]="completion",t[t.streamInvocation=4]="streamInvocation",t[t.cancelInvocation=5]="cancelInvocation",t[t.ping=6]="ping",t[t.close=7]="close",t}(G||{}),_i={protocol:"json",version:1},xi={type:G.ping},Ci={type:G.close},Ut=(t,n,e,i)=>({type:G.invocation,headers:i,invocationId:e,target:t,arguments:n}),bi=(t,n,e,i)=>({type:G.streamInvocation,headers:i,invocationId:e,target:t,arguments:n}),Ii=(t,n)=>({type:G.cancelInvocation,headers:n,invocationId:t}),Jt=function(t){return t.longPolling="LongPolling",t.serverSentEvents="ServerSentEvents",t.webSockets="WebSockets",t}(Jt||{}),Yt=function(t){return t.binary="Binary",t.text="Text",t}(Yt||{}),xe=function(t){return t[t.closed=0]="closed",t[t.opened=1]="opened",t[t.closing=2]="closing",t}(xe||{}),Me=class{get opened(){return!this.$maintenance.closed}get state(){return K(this.open$.pipe(S(()=>xe.opened)),this.close$.pipe(S(()=>xe.closed)),this.closing$.pipe(S(()=>xe.closing)))}constructor(n,e,i){this.serializer=e,this.headersFactory=i,this.lastInvocationId=0,this.open$=new $,this.close$=new $,this.closing$=new $,this.getHeaders=(o,a)=>this.headersFactory?this.headersFactory(o,a).pipe(Ge(1)):je(void 0),this.subject=Fe({url:n,serializer:o=>this.serializer.serialize(o),deserializer:o=>this.serializer.deserialize(o),openObserver:this.open$,closeObserver:this.close$,closingObserver:this.closing$}),this.$maintenance=this.subject.multiplex(()=>[_i],()=>[Ci],o=>o.some(({type:a})=>a===G.ping)).subscribe(o=>this.subject.next([xi]))}stream(n,...e){this.checkOpened();let i=this.nextInvocationId();return this.getHeaders(n,e).pipe(We(a=>this.subject.multiplex(()=>[bi(n,e,i,a)],()=>[Ii(i,a)],p=>!!p.find(u=>u.invocationId===i)))).pipe(oe(),re(a=>a.invocationId===i),ae(a=>{if(a.type===G.completion){let{error:p}=a;if(p)throw Error(p)}}),$e(a=>a.type!==G.completion),S(a=>a.item))}invoke(n,...e){this.checkOpened();let i=this.nextInvocationId();return this.getHeaders(n,e).pipe(S(o=>Ut(n,e,i,o))).subscribe(o=>this.subject.next([o])),this.subject.pipe(oe(),re(o=>o.invocationId===i),Ne(),S(o=>{let{error:a,result:p}=o;if(a)throw Error(a);return p}))}on(n){return this.checkOpened(),this.subject.pipe(oe(),re(({target:e})=>e===n),S(e=>e.arguments))}send(n,...e){this.checkOpened(),this.getHeaders(n,e).pipe(S(i=>Ut(n,e,void 0,i))).subscribe(i=>this.subject.next([i]))}close(){this.$maintenance?.unsubscribe(),this.subject.complete()}checkOpened(){if(!this.opened)throw Error("Connection not opened")}nextInvocationId(){return this.lastInvocationId++,this.lastInvocationId.toString()}},qt={propertyParsers:[]},Ce=class t{constructor(n,e){this.httpClient=n,this.options=L(L({},qt),e),this.serializer=new Le(this.options.propertyParsers)}static create(n,e){let i=qt;return e&&e(i),new t(n,i)}connect(n,e){return this.negotiate(n).pipe(S(i=>this.createConnection(n,i,e)))}negotiate(n){return this.httpClient.post(`${n}/negotiate`,null).pipe(S(e=>{if(!e.availableTransports.find(i=>i.transport===Jt.webSockets&&i.transferFormats.includes(Yt.text)))throw Error("SignalrClient supports only text WebSocket transport.");return e.connectionId}))}createConnection(n,e,i){let o=new URL(n,window.location.href);return o.protocol=o.protocol.replace(/^http/,"ws"),o.searchParams.append("id",e),i&&o.searchParams.append("access_token",i),new Me(o.href,this.serializer,this.options.headersFactory)}};var be=(()=>{class t{httpClient;appService;connection;playerName="";isFirstPlayer=!1;waitingUser=Y(null);status$;outcome$;constructor(e,i){this.httpClient=e,this.appService=i}initConnection(){Ce.create(this.httpClient).connect(Wt.rspGameHubURL).subscribe(i=>{this.connection=i,this.onStatusPipe(),this.onResultPipe(),this.onDisconnectPipe(),this.startRspGame()})}startRspGame(){this.playerName=this.appService.userData.name;let e=this.appService.userData.id;this.connection?.send("StartRspGame",e)}onStatusPipe(){let e=this.connection.on("WaitingForOpponent").pipe(S(()=>({status:"waiting"})),ae(()=>{this.isFirstPlayer=!0})),i=this.connection.on("GameStarted").pipe(S(([o,a,p])=>({status:"playing",player:this.playerName,player1:o,player2:a,group:p})));this.status$=K(e.pipe(Ve({status:"waiting"})),i)}throw(e,i){this.connection?.send("Throw",e,this.playerName,i)}onResultPipe(){let e=this.connection.on("Drawn").pipe(S(([o,a,p])=>({explanation:o,player1:a,player2:p}))),i=this.connection.on("Won").pipe(S(([o,a,p,u])=>({winner:o,explanation:a,player1:p,player2:u})));this.outcome$=K(e.pipe(S(o=>({type:"drawn",value:o}))),i.pipe(S(o=>({type:"won",value:o}))))}onDisconnectPipe(){this.connection.on("PlayerDisconnected").subscribe(()=>{this.appService.showSnackbar("Opponent has disconnected."),this.appService.router.navigate(["account"])})}static \u0275fac=function(i){return new(i||t)(_(at),_(g))};static \u0275prov=k({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Ai(t,n){if(t&1&&(s(0,"div",4),l(1),r()),t&2){let e=n.$implicit;c(),b(e)}}function Fi(t,n){if(t&1&&(s(0,"div",4),l(1),r()),t&2){let e=n.$implicit;c(),b(e)}}function Li(t,n){if(t&1&&(s(0,"div",16),h(1,"i"),r()),t&2){let e=d();m("ngStyle",e.playerChosenIcon.styles),c(),X(e.playerChosenIcon.icon)}}function Mi(t,n){t&1&&(s(0,"p"),l(1,"Waiting for your move..."),r())}function Ei(t,n){t&1&&(s(0,"p"),l(1,"Waiting for opponent move..."),r())}function Di(t,n){if(t&1&&(s(0,"div",17),h(1,"mat-spinner"),f(2,Mi,2,0,"p",10)(3,Ei,2,0,"p",10),r()),t&2){let e=d();c(2),m("ngIf",!e.playerChosenIcon),c(),m("ngIf",e.playerChosenIcon)}}function Ti(t,n){if(t&1&&(s(0,"p"),l(1),z(2,"async"),r()),t&2){let e,i=d();c(),b((e=U(2,1,i.output$))==null?null:e.displayIcons)}}function Oi(t,n){if(t&1&&(s(0,"div",18),h(1,"i"),r()),t&2){let e=d();m("ngStyle",e.opponentChosenIcon==null?null:e.opponentChosenIcon.styles),c(),X(e.opponentChosenIcon==null?null:e.opponentChosenIcon.icon)}}function Ri(t,n){if(t&1&&(s(0,"div",18),h(1,"i"),r()),t&2){let e=d();m("ngStyle",e.currentOpponentIcon.styles),c(),X(e.currentOpponentIcon.icon)}}function Pi(t,n){if(t&1){let e=w();s(0,"button",19),y("click",function(){let o=x(e).$implicit,a=d();return C(a.throw(o.value))}),h(1,"i"),r()}if(t&2){let e=n.$implicit,i=d();m("disabled",i.playerChosenIcon)("ngStyle",i.playerChosenIcon?i.Sign.noStyles:e.styles),c(),X(e.icon)}}function ji(t,n){if(t&1&&(s(0,"p"),l(1),z(2,"async"),r()),t&2){let e,i=d();c(),b((e=U(2,1,i.output$))==null?null:e.winnerState)}}var Kt=(()=>{class t{rspGameService;appService;Sign=ee;signs=ee.getAll();player1Stats=Y(null);player2Stats=Y(null);game;outputSubject=new Pe({displayIcons:"",winnerState:""});output$=this.outputSubject.asObservable();isOpponentMadeMove=Y(!1);disableButtons=!1;displayedColumns=["Wins","Loses","Draws"];playerChosenIcon;opponentChosenIcon;constructor(e,i){this.rspGameService=e,this.appService=i,this.rspGameService.outcome$.pipe(S(o=>{switch(o.type){case"drawn":return this.processDrawn(o.value);case"won":return this.processWon(o.value);default:throw"Unexpected result"}})).subscribe(o=>{this.outputSubject.next(o)})}ngOnInit(){this.startIconAnimation()}ngOnChanges(e){e.game&&this.game&&(this.player1Stats.set(this.game.player1??null),this.player2Stats.set(this.game.player2??null))}processDrawn(e){return this.isOpponentMadeMove.set(!0),this.updatePlayersState(e),this.setOpponentsSignIcon(e),this.resetGameScreen(),{displayIcons:"Equals",winnerState:"Draw"}}processWon(e){return this.isOpponentMadeMove.set(!0),this.game.winner=e.winner,this.updatePlayersState(e),this.setOpponentsSignIcon(e),this.resetGameScreen(),{displayIcons:e.winner==this.rspGameService.playerName?"Wins":"Loses",winnerState:e.winner==this.rspGameService.playerName?"You won!":`${e.winner} won.`}}updatePlayersState(e){e.player1.name==this.getPlayerName()?(this.player1Stats.set(e.player1),this.player2Stats.set(e.player2)):(this.player1Stats.set(e.player2),this.player2Stats.set(e.player1))}setOpponentsSignIcon(e){this.opponentChosenIcon="winner"in e?e.winner==this.rspGameService.playerName?this.Sign.getByValue(this.rspGameService.isFirstPlayer?+e.player2?.sign:+e.player1?.sign):this.Sign.getByValue(this.rspGameService.isFirstPlayer?+e.player2?.sign:+e.player1?.sign):this.Sign.getByValue(this.rspGameService.isFirstPlayer?+e.player2?.sign:+e.player1?.sign)}throw(e){this.playerChosenIcon=this.Sign.getByValue(e),this.rspGameService.throw(this.game.group,this.playerChosenIcon.sign),this.disableButtons=!0}isOpponent(){return this.player1Stats()?.name!==this.appService.userData.name}getPlayerName(){return this.isOpponent()?this.player2Stats()?.name:this.player1Stats()?.name}getOpponentName(){return this.isOpponent()?this.player1Stats()?.name:this.player2Stats()?.name}getPlayerWins(e){return this.isOpponent()==e?this.player1Stats()?.rspWins:this.player2Stats()?.rspWins}getPlayerDraws(e){return this.isOpponent()==e?this.player1Stats()?.rspDraws:this.player2Stats()?.rspDraws}getPlayerLoses(e){return this.isOpponent()==e?(this.player1Stats()?.rspGames??0)-(this.player1Stats()?.rspWins??0)-(this.player1Stats()?.rspDraws??0):(this.player2Stats()?.rspGames??0)-(this.player2Stats()?.rspWins??0)-(this.player1Stats()?.rspDraws??0)}isWinnerOpponent(){return this.game?.winner!=this.appService.userData.name}cyclingIcons;currentOpponentIcon=this.signs[0];startIconAnimation(){let e=0;this.cyclingIcons=setInterval(()=>{this.currentOpponentIcon=this.signs[e],e=(e+1)%this.signs.length},330)}stopIconAnimation(){clearInterval(this.cyclingIcons)}resetGameScreen(){this.stopIconAnimation(),setTimeout(()=>{this.isOpponentMadeMove.set(!1),this.playerChosenIcon=void 0,this.opponentChosenIcon=void 0,this.game.winner=void 0,this.disableButtons=!1,this.startIconAnimation(),this.outputSubject.next({displayIcons:"",winnerState:""})},5e3)}static \u0275fac=function(i){return new(i||t)(v(be),v(g))};static \u0275cmp=A({type:t,selectors:[["app-rsp-game"]],inputs:{game:"game"},standalone:!0,features:[qe,F],decls:39,vars:21,consts:[["cyclingIcons",""],["fxFlex","","fxLayout","column"],["fxFlex","12%","fxLayout","column",1,"boarded"],["fxFlex","","fxLayout","row"],["fxFlex","","fxLayoutAlign","center center"],["fxFlex","","fxLayoutAlign","center center",4,"ngFor","ngForOf"],["fxFlex","45%","fxLayoutAlign","space-between center"],["fxFlex","","fxLayoutAlign","center center",1,"result"],["fxLayoutAlign","center center",3,"ngStyle",4,"ngIf"],["fxLayout","column","fxLayoutAlign","center center",4,"ngIf"],[4,"ngIf"],[3,"ngStyle",4,"ngIf","ngIfElse"],["fxFlex","28%","fxLayoutAlign","center center","fxLayoutGap","40px"],["mat-fab","",3,"disabled","ngStyle","click",4,"ngFor","ngForOf"],["fxFlex","15%","fxLayout","column","fxLayoutAlign","start center",1,"message-section"],["fxLayout","column",1,"message-content"],["fxLayoutAlign","center center",3,"ngStyle"],["fxLayout","column","fxLayoutAlign","center center"],[3,"ngStyle"],["mat-fab","",3,"click","disabled","ngStyle"]],template:function(i,o){if(i&1&&(s(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),l(4),r(),s(5,"div",4),l(6),r()(),s(7,"div",3),f(8,Ai,2,1,"div",5)(9,Fi,2,1,"div",5),r(),s(10,"div",3)(11,"div",4),l(12),r(),s(13,"div",4),l(14),r(),s(15,"div",4),l(16),r(),s(17,"div",4),l(18),r(),s(19,"div",4),l(20),r(),s(21,"div",4),l(22),r()()(),s(23,"div",6)(24,"div",7),f(25,Li,2,3,"div",8),r(),f(26,Di,4,2,"div",9)(27,Ti,3,3,"p",10),z(28,"async"),s(29,"div",7),f(30,Oi,2,3,"div",11)(31,Ri,2,3,"ng-template",null,0,ce),r()(),s(33,"div",12),f(34,Pi,2,5,"button",13),r(),s(35,"div",14)(36,"div",15),f(37,ji,3,3,"p",10),z(38,"async"),r()()()),i&2){let a,p,u=B(32);c(4),b(o.getPlayerName()),c(2),b(o.getOpponentName()),c(2),m("ngForOf",o.displayedColumns),c(),m("ngForOf",o.displayedColumns),c(3),b(o.getPlayerWins(!1)),c(2),b(o.getPlayerLoses(!1)),c(2),b(o.getPlayerDraws(!1)),c(2),b(o.getPlayerWins(!0)),c(2),b(o.getPlayerLoses(!0)),c(2),b(o.getPlayerDraws(!0)),c(3),m("ngIf",o.playerChosenIcon),c(),m("ngIf",!o.isOpponentMadeMove()),c(),m("ngIf",(a=U(28,17,o.output$))==null?null:a.displayIcons),c(3),m("ngIf",o.isOpponentMadeMove())("ngIfElse",u),c(4),m("ngForOf",o.signs),c(3),m("ngIf",(p=U(38,19,o.output$))==null?null:p.winnerState)}},dependencies:[D,it,R,rt,It,ue,E,he,P,V,Nt,le],styles:["[_nghost-%COMP%]{height:100%}button[_ngcontent-%COMP%]{transition:transform .2s}button[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.boarded[_ngcontent-%COMP%]{display:flex;flex-direction:column}.boarded[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;flex-direction:row}.boarded[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{border-top:1px solid black;border-left:1px solid black}.boarded[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:last-child{border-right:1px solid black}.boarded[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:last-child   div[_ngcontent-%COMP%]{border-bottom:1px solid black}"]})}return t})();function Gi(t,n){t&1&&(s(0,"div",6)(1,"p"),l(2,"Waiting for another player to connect ..."),r(),h(3,"mat-spinner"),r())}function Ni(t,n){if(t&1&&h(0,"app-rsp-game",7),t&2){let e=d().ngIf;m("game",e)}}function Vi(t,n){if(t&1&&(s(0,"div",3),f(1,Gi,4,0,"div",4)(2,Ni,1,1,"app-rsp-game",5),r()),t&2){let e=n.ngIf;m("ngSwitch",e.status),c(),m("ngSwitchCase","waiting"),c(),m("ngSwitchCase","playing")}}function Wi(t,n){t&1&&(s(0,"p"),l(1,"Waiting for server connection ..."),r())}var Xt=(()=>{class t{appService;rspGameService;get status$(){return this.rspGameService.status$}constructor(e,i){this.appService=e,this.rspGameService=i}ngOnInit(){this.rspGameService.initConnection()}static \u0275fac=function(i){return new(i||t)(v(g),v(be))};static \u0275cmp=A({type:t,selectors:[["app-game-manager"]],standalone:!0,features:[F],decls:5,vars:4,consts:[["not_connected",""],["fxLayout","column",2,"height","100%"],["style","height: 100%;",3,"ngSwitch",4,"ngIf","ngIfElse"],[2,"height","100%",3,"ngSwitch"],["fxLayout","column","fxLayoutAlign","center center","style","height: 80%;",4,"ngSwitchCase"],[3,"game",4,"ngSwitchCase"],["fxLayout","column","fxLayoutAlign","center center",2,"height","80%"],[3,"game"]],template:function(i,o){if(i&1&&(s(0,"div",1),f(1,Vi,3,3,"div",2),z(2,"async"),f(3,Wi,2,0,"ng-template",null,0,ce),r()),i&2){let a=B(4);c(),m("ngIf",U(2,2,o.status$))("ngIfElse",a)}},dependencies:[D,R,nt,ot,ue,E,P,le,Kt]})}return t})();var Qt=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275cmp=A({type:t,selectors:[["app-account"]],standalone:!0,features:[F],decls:2,vars:0,template:function(i,o){i&1&&(s(0,"p"),l(1,"account works!"),r())}})}return t})();var ei=[{path:"",redirectTo:"auth",pathMatch:"full"},{path:"auth",component:zt},{path:"account",component:Qt,canActivate:[ye]},{path:"game-manager",component:Xt,canActivate:[ye]},{path:"user-connection-state",loadComponent:()=>import("./chunk-NNOP5Q5T.js").then(t=>t.UserConnectionStateComponent),canActivate:[ye]},{path:"**",redirectTo:"auth",pathMatch:"full"}];var $i="@",Bi=(()=>{let n=class n{constructor(i,o,a,p,u){this.doc=i,this.delegate=o,this.zone=a,this.animationType=p,this.moduleImpl=u,this._rendererFactoryPromise=null,this.scheduler=ke(Ke,{optional:!0}),this.loadingSchedulerFn=ke(Hi,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){let i=()=>this.moduleImpl??import("./chunk-3JV7RZKW.js").then(a=>a),o;return this.loadingSchedulerFn?o=this.loadingSchedulerFn(i):o=i(),o.catch(a=>{throw new Be(5300,!1)}).then(({\u0275createEngine:a,\u0275AnimationRendererFactory:p})=>{this._engine=a(this.animationType,this.doc);let u=new p(this.delegate,this._engine,this.zone);return this.delegate=u,u})}createRenderer(i,o){let a=this.delegate.createRenderer(i,o);if(a.\u0275type===0)return a;typeof a.throwOnSyntheticProps=="boolean"&&(a.throwOnSyntheticProps=!1);let p=new Ee(a);return o?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(u=>{let I=u.createRenderer(i,o);p.use(I),this.scheduler?.notify(10)}).catch(u=>{p.use(a)}),p}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};n.\u0275fac=function(o){Ze()},n.\u0275prov=k({token:n,factory:n.\u0275fac});let t=n;return t})(),Ee=class{constructor(n){this.delegate=n,this.replay=[],this.\u0275type=1}use(n){if(this.delegate=n,this.replay!==null){for(let e of this.replay)e(n);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(n,e){return this.delegate.createElement(n,e)}createComment(n){return this.delegate.createComment(n)}createText(n){return this.delegate.createText(n)}get destroyNode(){return this.delegate.destroyNode}appendChild(n,e){this.delegate.appendChild(n,e)}insertBefore(n,e,i,o){this.delegate.insertBefore(n,e,i,o)}removeChild(n,e,i){this.delegate.removeChild(n,e,i)}selectRootElement(n,e){return this.delegate.selectRootElement(n,e)}parentNode(n){return this.delegate.parentNode(n)}nextSibling(n){return this.delegate.nextSibling(n)}setAttribute(n,e,i,o){this.delegate.setAttribute(n,e,i,o)}removeAttribute(n,e,i){this.delegate.removeAttribute(n,e,i)}addClass(n,e){this.delegate.addClass(n,e)}removeClass(n,e){this.delegate.removeClass(n,e)}setStyle(n,e,i,o){this.delegate.setStyle(n,e,i,o)}removeStyle(n,e,i){this.delegate.removeStyle(n,e,i)}setProperty(n,e,i){this.shouldReplay(e)&&this.replay.push(o=>o.setProperty(n,e,i)),this.delegate.setProperty(n,e,i)}setValue(n,e){this.delegate.setValue(n,e)}listen(n,e,i){return this.shouldReplay(e)&&this.replay.push(o=>o.listen(n,e,i)),this.delegate.listen(n,e,i)}shouldReplay(n){return this.replay!==null&&n.startsWith($i)}},Hi=new He("");function ti(t="animations"){return Qe("NgAsyncAnimations"),ze([{provide:Xe,useFactory:(n,e,i)=>new Bi(n,e,i,t),deps:[tt,lt,Je]},{provide:Ye,useValue:t==="noop"?"NoopAnimations":"BrowserAnimations"}])}var ii={providers:[et({eventCoalescing:!0}),ht(ei,ft(ut)),mt(),ti(),st(ct()),Ue(gt)]};function zi(t,n){if(t&1){let e=w();s(0,"a",8),y("click",function(){x(e);let o=d();return C(o.onCloseSidenav())}),h(1,"i",9),l(2," Account "),r()}}function Ui(t,n){if(t&1){let e=w();s(0,"a",10),y("click",function(){x(e);let o=d();return C(o.onAccessMode())})("click",function(){x(e);let o=d();return C(o.onCloseSidenav())}),h(1,"i",11),l(2," SignUp "),r()}}function qi(t,n){if(t&1){let e=w();s(0,"a",12),y("click",function(){x(e);let o=d();return C(o.onAccessMode())})("click",function(){x(e);let o=d();return C(o.onCloseSidenav())}),h(1,"i",13),l(2," Login "),r()}}function Ji(t,n){if(t&1){let e=w();s(0,"a",14),y("click",function(){x(e);let o=d();return C(o.onCloseSidenav())}),h(1,"i",15),l(2),r()}if(t&2){let e=d();c(2),H(" ",e.rspBtn," ")}}function Yi(t,n){if(t&1){let e=w();s(0,"a",16),y("click",function(){x(e);let o=d();return C(o.onCloseSidenav())}),h(1,"i",17),l(2),r()}if(t&2){let e=d();c(2),H(" ",e.connBtn," ")}}function Zi(t,n){if(t&1){let e=w();s(0,"a",18),y("click",function(){x(e);let o=d();return C(o.onLogout())}),h(1,"i",19),l(2," Logout "),r()}}var oi=(()=>{class t{appService;logoutService;closeSidenav=new se;isRegisterMode=O(()=>this.appService.isRegisterMode());isAuthenticated=O(()=>this.appService.isAuthenticated());connBtn="User Connection State";rspBtn="Rock-Scissors-Paper";constructor(e,i){this.appService=e,this.logoutService=i}onAccessMode(){this.appService.isRegisterMode.set(!this.isRegisterMode())}onCloseSidenav(){this.closeSidenav.emit()}onLogout(){this.onCloseSidenav(),this.logoutService.logout()}static \u0275fac=function(i){return new(i||t)(v(g),v(Z))};static \u0275cmp=A({type:t,selectors:[["app-sidenav"]],outputs:{closeSidenav:"closeSidenav"},standalone:!0,features:[F],decls:12,vars:6,consts:[["fxLayout","column","fxLayoutAlign","start stretch","fxFlexFill","",1,"sidenav-list"],["mat-list-item","","routerLink","/account",3,"click",4,"ngIf"],["mat-list-item","","tabindex","-1",3,"click",4,"ngIf"],["mat-list-item","",3,"click",4,"ngIf"],["mat-list-item","","routerLink","/game-manager","tabindex","-1",3,"click",4,"ngIf"],["mat-list-item","","routerLink","/user-connection-state","tabindex","-1",3,"click",4,"ngIf"],["fxFlex",""],["mat-list-item","","fxLayoutAlign","end center",3,"click",4,"ngIf"],["mat-list-item","","routerLink","/account",3,"click"],[1,"fa-solid","fa-user"],["mat-list-item","","tabindex","-1",3,"click"],[1,"fa-solid","fa-user-plus"],["mat-list-item","",3,"click"],[1,"fa-solid","fa-arrow-right-to-bracket"],["mat-list-item","","routerLink","/game-manager","tabindex","-1",3,"click"],[1,"fa-solid","fa-gamepad"],["mat-list-item","","routerLink","/user-connection-state","tabindex","-1",3,"click"],[1,"fa-solid","fa-network-wired"],["mat-list-item","","fxLayoutAlign","end center",3,"click"],[1,"fa-solid","fa-right-from-bracket"]],template:function(i,o){i&1&&(s(0,"mat-nav-list",0),f(1,zi,3,0,"a",1)(2,Ui,3,0,"a",2)(3,qi,3,0,"a",3),h(4,"mat-divider"),f(5,Ji,3,1,"a",4)(6,Yi,3,1,"a",5),h(7,"mat-divider")(8,"div",6)(9,"mat-divider"),f(10,Zi,3,0,"a",7),h(11,"mat-divider"),r()),i&2&&(c(),m("ngIf",o.isAuthenticated()),c(),m("ngIf",!o.isAuthenticated()&&!o.isRegisterMode()),c(),m("ngIf",!o.isAuthenticated()&&o.isRegisterMode()),c(2),m("ngIf",o.isAuthenticated()),c(),m("ngIf",o.appService.isAdminUser()),c(4),m("ngIf",o.isAuthenticated()))},dependencies:[D,R,Tt,Dt,Et,E,P,fe,V,pe],styles:["mat-sidenav{width:250px}"]})}return t})();function Ki(t,n){if(t&1&&(s(0,"button",9),l(1),r()),t&2){let e=d();c(),H("",e.connBtn," ")}}function Xi(t,n){if(t&1&&(s(0,"button",10),l(1),r()),t&2){let e=d();c(),b(e.rspBtn)}}function Qi(t,n){if(t&1){let e=w();s(0,"button",11),y("click",function(){x(e);let o=d();return C(o.onAccessMode())}),l(1,"SignUp"),r()}}function en(t,n){if(t&1){let e=w();s(0,"button",11),y("click",function(){x(e);let o=d();return C(o.onAccessMode())}),l(1,"Login"),r()}}function tn(t,n){if(t&1){let e=w();s(0,"button",11),y("click",function(){x(e);let o=d();return C(o.onLogout())}),l(1,"Logout"),r()}}var ri=(()=>{class t{appService;logoutService;sidenavToggle=new se;isRegisterMode=O(()=>this.appService.isRegisterMode());isAuthenticated=O(()=>this.appService.isAuthenticated());connBtn="User Connection State";rspBtn="Rock-Scissors-Paper";constructor(e,i){this.appService=e,this.logoutService=i}onAccessMode(){this.appService.isRegisterMode.set(!this.isRegisterMode())}onToggleSidenav(){this.sidenavToggle.emit()}onLogout(){this.logoutService.logout()}static \u0275fac=function(i){return new(i||t)(v(g),v(Z))};static \u0275cmp=A({type:t,selectors:[["app-header"]],outputs:{sidenavToggle:"sidenavToggle"},standalone:!0,features:[F],decls:14,vars:5,consts:[["color","primary"],["fxHide.gt-xs",""],["mat-icon-button","","onclick","this.blur()",3,"click"],["fxLayoutAlign","center center","mat-button","","routerLink","/account",2,"cursor","pointer","display","flex","align-items","center"],["fxFlex","","fxLayout","","fxLayoutAlign","flex-end","fxHide.xs",""],["fxLayout","","fxLayoutGap","10px"],["mat-button","","routerLink","/user-connection-state",4,"ngIf"],["mat-button","","routerLink","/game-manager",4,"ngIf"],["mat-button","",3,"click",4,"ngIf"],["mat-button","","routerLink","/user-connection-state"],["mat-button","","routerLink","/game-manager"],["mat-button","",3,"click"]],template:function(i,o){i&1&&(s(0,"mat-toolbar",0)(1,"div",1)(2,"button",2),y("click",function(){return o.onToggleSidenav()}),s(3,"mat-icon"),l(4,"menu"),r()()(),s(5,"div",3),l(6," Game Demo "),r(),s(7,"div",4)(8,"div",5),f(9,Ki,2,1,"button",6)(10,Xi,2,1,"button",7)(11,Qi,2,0,"button",8)(12,en,2,0,"button",8)(13,tn,2,0,"button",8),r()()()),i&2&&(c(9),m("ngIf",o.appService.isAdminUser()),c(),m("ngIf",o.isAuthenticated()),c(),m("ngIf",!o.isAuthenticated()&&!o.isRegisterMode()),c(),m("ngIf",!o.isAuthenticated()&&o.isRegisterMode()),c(),m("ngIf",o.isAuthenticated()))},dependencies:[D,R,de,wt,kt,Ot,E,he,P,V,Gt,pe]})}return t})();var ai=(()=>{class t{appService;signalrService;methodName="ValidationToken";successCommand="Valid_Token_Success";failCommand="Valid_Token_Fail";constructor(e,i){this.appService=e,this.signalrService=i}launchValidationToken(){this.validateTokenListenSuccess(),this.validateTokenListenFail(),this.validationTokenAsync()}validationTokenAsync(){return J(this,null,function*(){try{console.log("#3 validationToken"),yield this.signalrService.hubConnection.invoke(this.methodName,this.appService.getToken()).then(()=>{console.log("#7 after validationToken: then()")}).catch(e=>console.log(e))}catch(e){console.log(e)}})}validateTokenListenSuccess(){try{console.log("#2 validateTokenListenSuccess"),this.signalrService.hubConnection.on(this.successCommand,e=>{console.log("#4 validateTokenListenSuccess"),this.appService.userData=L({},e),this.appService.isAuthenticated.set(!0),this.appService.showSnackbar("Re-authentificated!"),this.appService.router.url==="/auth"?this.appService.router.navigate(["account"]):this.appService.router.navigate([this.appService.router.url]),this.signalrService.offConnection([this.successCommand,this.failCommand])})}catch(e){console.log(e)}}validateTokenListenFail(){try{console.log("#2 validateTokenListenFail"),this.signalrService.hubConnection.on(this.failCommand,()=>{console.log("#4 token expaired"),localStorage.removeItem("token"),this.appService.showSnackbar("Previous session is expired. Access again with your email and password please.")})}catch(e){console.log(e)}}static \u0275fac=function(i){return new(i||t)(_(g),_(W))};static \u0275prov=k({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var si=(()=>{class t{appService;signalrService;validationTokenService;constructor(e,i,o){this.appService=e,this.signalrService=i,this.validationTokenService=o}checkAuthentication(){typeof window>"u"||this.signalrService.startConnection().then(()=>{let e=this.appService.getToken();this.signalrService.hasConnection()&&e?(console.log("#1 Has token"),this.validationTokenService.launchValidationToken()):console.log("SignalR connection not established or no token.")}).catch(e=>console.error("Error starting SignalR connection:",e))}static \u0275fac=function(i){return new(i||t)(_(g),_(W),_(ai))};static \u0275prov=k({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var ci=(()=>{class t{logoutService;loginService;appService;title="signalr-demo";isAuthenticated=O(()=>this.appService.isAuthenticated());constructor(e,i,o){this.logoutService=e,this.loginService=i,this.appService=o}ngOnInit(){this.loginService.checkAuthentication()}static \u0275fac=function(i){return new(i||t)(v(Z),v(si),v(g))};static \u0275cmp=A({type:t,selectors:[["app-root"]],standalone:!0,features:[F],decls:13,vars:0,consts:[["sNav",""],["role","navigation"],[3,"closeSidenav"],["fxLayout","column","fxFill",""],[3,"sidenavToggle"],["fxFlex",""],["fxLayout","column",2,"width","100%"],["fxLayout","row"],["fxFlex","90"],["fxFlexAlign","center"]],template:function(i,o){if(i&1){let a=w();s(0,"mat-sidenav-container")(1,"mat-sidenav",1,0)(3,"app-sidenav",2),y("closeSidenav",function(){x(a);let u=B(2);return C(u.close())}),r()(),s(4,"mat-sidenav-content",3)(5,"app-header",4),y("sidenavToggle",function(){x(a);let u=B(2);return C(u.toggle())}),r(),s(6,"main",5),h(7,"router-outlet"),r(),s(8,"footer",6)(9,"div",7),h(10,"hr",8),r(),s(11,"p",9),l(12,"Copyright \xA9 2024 SignalR Game System"),r()()()()}},dependencies:[dt,D,Pt,jt,Rt,E,fe,Vt,V,oi,ri],styles:["mat-sidenav-container[_ngcontent-%COMP%], mat-sidenav[_ngcontent-%COMP%], mat-sidenav-content[_ngcontent-%COMP%]{height:100%}mat-sidenav[_ngcontent-%COMP%]{width:250px}"]})}return t})();pt(ci,ii).catch(t=>console.error(t));
